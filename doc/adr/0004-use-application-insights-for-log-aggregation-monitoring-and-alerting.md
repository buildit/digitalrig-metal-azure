# 4. Use Application Insights for log aggregation, monitoring, and alerting

Date: 2019-03-27

## Status

Accepted

## Context

Logs are generated by each instance of a container. We need the ability to see and search across all instances.

## Decision

We will use Application Insights to aggregate our logs (called Trace in Application Insights). We will utliize Application Insights Alarms to notify when ERROR logs are generated

## Consequences

* Microsoft is redesigning a lot of their Monitoring solutions under 1 umbrella called Azure Monitor.  Application Insights probably will live under this umbrella and/or get renamed
* Application Insights supports all kinds of telemetry: logs, metrics, exceptions, requests, dependency tracking.
* There does not appear to be an out of the box solution to stream Docker logs into Application Insights
* Instead, Application Insights provides SDKs that applications use to send logs, metrics, telemetry to Application Insights.  As such, our applications will carry a dependency on Application Insights (hopefully abstracted via some logging framework).
* Application Insight Alarms exist as both a Classic version and a "new" version <https://docs.microsoft.com/en-us/azure/azure-monitor/platform/alerts-overview>.  The `az` CLI does not support the creation of "new" Alarms.  As such, we won't be able to automate the creation of these Alarms unless we switch to the REST API for Azure or use ARM templates.
* There is a bit of delay between when a log is logged and when it appears in Application Insights.  Then a further delay when the Alert monitor triggers.